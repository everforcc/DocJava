
~~~

当 master1和master2同时向slave同步20000条数据时，在id没有重复的情况时，出现了这个报错


znkj@znkj:~/cc/mysql/10.1.1. u591au6e90u590du5236$ docker exec mysql-slave mysql -uroot -proot -e "SELECT * FROM performance_schema.replication_applier_status_by_worker WHERE LAST_ERROR_NUMBER != 0 LIMIT 10\G"
mysql: [Warning] Using a password on the command line interface can be insecure.
*************************** 1. row ***************************
                                           CHANNEL_NAME: master2
                                              WORKER_ID: 1
                                              THREAD_ID: NULL
                                          SERVICE_STATE: OFF
                                      LAST_ERROR_NUMBER: 1304
                                     LAST_ERROR_MESSAGE: Worker 1 failed executing transaction 'fa88ceb7-3220-11f0-9c36-0242ac160002:7' at source log mysql-bin.000002, end_log_pos 649; Error 'PROCEDURE InsertTestData already exists' on query. Default database: 'db_test_sync'. Query: 'CREATE DEFINER=`everforcc`@`%` PROCEDURE `InsertTestData`()
BEGIN
    DECLARE i INT DEFAULT 1;
    WHILE i <= 10000 DO
            INSERT INTO test_sync(id,name) VALUES (i+200000,CONCAT('s2??', i));
            SET i = i + 1;
        END WHILE;
END'
                                   LAST_ERROR_TIMESTAMP: 2025-05-16 06:44:44.753392
                               LAST_APPLIED_TRANSACTION: fa88ceb7-3220-11f0-9c36-0242ac160002:6
     LAST_APPLIED_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 2025-05-16 06:43:00.790536
    LAST_APPLIED_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 2025-05-16 06:43:00.790536
         LAST_APPLIED_TRANSACTION_START_APPLY_TIMESTAMP: 2025-05-16 06:43:47.395101
           LAST_APPLIED_TRANSACTION_END_APPLY_TIMESTAMP: 2025-05-16 06:43:47.397033
                                   APPLYING_TRANSACTION: fa88ceb7-3220-11f0-9c36-0242ac160002:7
         APPLYING_TRANSACTION_ORIGINAL_COMMIT_TIMESTAMP: 2025-05-16 06:44:44.752113
        APPLYING_TRANSACTION_IMMEDIATE_COMMIT_TIMESTAMP: 2025-05-16 06:44:44.752113
             APPLYING_TRANSACTION_START_APPLY_TIMESTAMP: 2025-05-16 06:44:44.753035
                 LAST_APPLIED_TRANSACTION_RETRIES_COUNT: 0
   LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0
  LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: 
LAST_APPLIED_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000
                     APPLYING_TRANSACTION_RETRIES_COUNT: 0
       APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_NUMBER: 0
      APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_MESSAGE: 
    APPLYING_TRANSACTION_LAST_TRANSIENT_ERROR_TIMESTAMP: 0000-00-00 00:00:00.000000
znkj@znkj:~/cc/mysql/10.1.1. u591au6e90u590du5236$ 


我找到问题了。错误信息显示：
Apply to docker-compo...
Error 'PROCEDURE InsertTestData already exists' on query.

这是一个对象名冲突问题。虽然表数据ID没有重复，但是master1和master2都尝试创建同名的存储过程InsertTestData：
master1先创建了存储过程InsertTestData并成功同步到slave
当master2尝试创建相同名称的存储过程时，在slave上执行失败，因为该存储过程已存在
解决方案：
跳过这个错误继续同步：
docker exec mysql-slave mysql -uroot -proot -e "STOP REPLICA FOR CHANNEL 'master2'; SET GLOBAL sql_slave_skip_counter=1; START REPLICA FOR CHANNEL 'master2';"

Apply to docker-compo...
长期解决方案 - 修改多源复制架构，确保不同主库使用不同的对象命名空间：
修改master2的存储过程名称为InsertTestData_master2
在不同主库中使用不同的数据库名
使用数据库前缀或后缀区分不同主库的对象
这个问题是多源复制中的典型冲突情况，即使数据主键不冲突，数据库对象名称冲突也会导致复制中断。

~~~
