<span  style="font-family: Simsun,serif; font-size: 17px; ">

[TOC]

### DisableCircularReferenceDetect

### 现象

~~~
[
  {
    "key0": [
      {
        "description": "第几个对象: 0"
      },
      {
        "description": "第几个对象: 1"
      },
      {
        "description": "第几个对象: 2"
      }
    ],
    "k": 2
  },
  {
    "$ref": "$[0]"
  },
  {
    "$ref": "$[0]"
  }
]
~~~

### 复现

~~~java
@GetMapping("/a")
public String H() {
    JSONArray jsonArray = new JSONArray();
    ParamDto pre = new ParamDto();
    pre.setName("name");
    pre.setDate(new Date());

    for (int i = 0; i < 3; i++) {
        ParamDto paramDto = new ParamDto();
        paramDto.setDescription("第几个对象: " + i);
        pre.setName("name");
        jsonArray.add(paramDto);
    }

    JSONObject jsonObject = new JSONObject();
    for (int i = 0; i < 3; i++) {
        jsonObject.put("k", i);
        jsonObject.put("key0", jsonArray);
    }

    JSONArray jsonArray2 = new JSONArray();
    for (int i = 0; i < 3; i++) {
        jsonArray2.add(jsonObject);
    }

    return JSON.toJSONString(jsonArray2);
    }
~~~

### 处理

- 处理循环依赖
- 两种方式
~~~java
@Bean
public FastJsonHttpMessageConverter fastJsonHttpMessageConverter() {
    JSON.DEFAULT_GENERATE_FEATURE |= SerializerFeature.DisableCircularReferenceDetect.getMask(); // 解决循环引用问题
    final FastJsonHttpMessageConverter converter = new FastJsonHttpMessageConverter();
    converter.setDefaultCharset(UTF_8);
    converter.getFastJsonConfig().setFeatures(Feature.OrderedField);
    converter.setSupportedMediaTypes(Collections.singletonList(
            MediaType.APPLICATION_JSON
    ));
    return converter;
}
~~~
- 另一种
~~~java

~~~

</span>