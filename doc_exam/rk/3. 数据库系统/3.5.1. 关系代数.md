<span  style="font-family: Simsun,serif; font-size: 17px;">

# 软考数据库——关系代数详解
在软考（如软件设计师、数据库系统工程师）的数据库部分，**关系代数**是核心考点之一，主要用于描述关系数据库中的数据查询操作，是 SQL 语言的理论基础。掌握关系代数不仅能应对选择题中的运算规则考核，也能辅助理解 SQL 查询的逻辑（如复杂查询的等价转换）。


## 一、关系代数的基本概念
关系代数以“关系”（即数据库中的表）为运算对象，通过一系列**关系运算**生成新的关系（查询结果）。其运算可分为两大类：
- **传统集合运算**：基于集合论，如并、交、差、笛卡尔积；
- **专门关系运算**：针对关系数据的特有运算，如选择、投影、连接、除。

### 基础符号定义
- 设关系模式为 R(A₁, A₂, ..., Aₙ)：R 为关系名（表名），A₁…Aₙ 为属性名（列名）；
- 元组：关系中的一行（对应数据库中的“记录”）；
- 属性：关系中的一列（对应数据库中的“字段”）；
- 用 t 表示元组，t[Aᵢ] 表示元组 t 在属性 Aᵢ 上的值。


## 二、传统集合运算（4种）
传统集合运算要求两个操作关系**结构完全一致**（属性个数相同、对应属性的域相同），运算规则与数学集合运算类似。

| 运算名称       | 符号          | 定义与逻辑                                                                 | 示例（学生表 R + 选课学生表 S）                          |
|----------------|---------------|----------------------------------------------------------------------------|---------------------------------------------------------|
| **并（Union）** | R ∪ S         | 由属于 R **或** 属于 S 的所有元组组成，**自动去重**（与 SQL 的 `UNION` 一致）。 | 求“所有学生或选课学生”，结果为 R 和 S 元组合并后去重。 |
| **交（Intersection）** | R ∩ S | 由既属于 R **又** 属于 S 的所有元组组成。                                 | 求“既是学生又是选课学生”，结果为 R 和 S 的共同元组。   |
| **差（Difference）** | R - S    | 由属于 R **但不属于** S 的所有元组组成（注意：R - S ≠ S - R）。             | 求“是学生但未选课的人”，结果为 R 中排除 S 的元组。     |
| **笛卡尔积（Cartesian Product）** | R × S | 将 R 的每个元组与 S 的每个元组拼接，属性数 = R 属性数 + S 属性数，元组数 = R 元组数 × S 元组数（**需配合选择运算筛选才有效**）。 | 若 R 有 2 个元组、S 有 3 个元组，则 R × S 有 6 个元组。 |


## 三、专门关系运算（4种）
专门关系运算是关系代数的核心，不要求操作关系结构一致，针对“属性筛选”“元组关联”等场景设计，是 SQL 查询的核心理论支撑。


### 1. 选择（Selection）：筛选行（元组）
- **核心作用**：从关系 R 中筛选满足条件的元组，属性数不变，元组数减少。
- **符号**：σ<sub>F</sub>(R)，其中：
    - σ（sigma）：选择运算符；
    - F：筛选条件（逻辑表达式，如 Age > 20、Sex = '男'）；
    - 支持运算符：比较运算符（>, <, =, ≠, ≥, ≤）、逻辑运算符（∧且、∨或、¬非）。

- **示例**：  
  学生表 Student(Sno, Sname, Sex, Age) 中，筛选“性别为男且年龄大于 20”的学生：  
  σ<sub>Sex='男' ∧ Age>20</sub>(Student)  
  （对应 SQL：`SELECT * FROM Student WHERE Sex='男' AND Age>20;`）


### 2. 投影（Projection）：筛选列（属性）
- **核心作用**：从关系 R 中选择指定属性列，属性数减少，元组数不变或减少（**自动去重重复元组**）。
- **符号**：Π<sub>A</sub>(R)，其中：
    - Π（pi）：投影运算符；
    - A：目标属性列表（多属性用逗号分隔，如 Sno, Sname）。

- **示例**：  
  从学生表 Student 中保留“学号和姓名”：  
  Π<sub>Sno, Sname</sub>(Student)  
  （对应 SQL：`SELECT DISTINCT Sno, Sname FROM Student;`，`DISTINCT` 对应投影的去重逻辑）


### 3. 连接（Join）：关联两个关系（核心考点）
- **核心作用**：基于“公共属性”或“条件”拼接两个关系 R 和 S，避免无意义的笛卡尔积，是多表查询的核心。
- **分类与对比**：软考重点考核等值连接、自然连接、外连接，三者区别如下：

| 连接类型       | 定义与关键特征                                                                 | 示例（R(Sno, Sname) 学生表 + S(Sno, Cno) 选课表） |
|----------------|------------------------------------------------------------------------------|---------------------------------------------------|
| **θ连接（条件连接）** | 基于任意比较条件 F（如 R.AθS.B，θ是比较运算符）的连接，即 σ<sub>F</sub>(R × S)，实际应用极少。 | 筛选“学生学号 > 选课学号”：σ<sub>R.Sno > S.Sno</sub>(R × S) |
| **等值连接**     | θ连接的特殊情况：条件仅为“属性相等”（如 R.A=S.B），**公共属性重复保留**（如结果含两个 Sno 列）。 | 关联学生与选课表（学号相等）：σ<sub>R.Sno = S.Sno</sub>(R × S)，结果含 R.Sno 和 S.Sno |
| **自然连接（Natural Join）** | 等值连接的优化：**默认基于所有同名公共属性等值连接**，且**自动去除重复公共属性**（仅保留一份），是实际最常用连接。 | 学生表与选课表自然连接：R ⋈ S（符号 ⋈），结果仅含一个 Sno 列，元组为“学生+选课记录” |
| **外连接**       | 解决自然连接“丢失不匹配元组”问题：左外连接（保留 R 所有元组）、右外连接（保留 S 所有元组）、全外连接（保留两者所有元组），不匹配属性填 NULL。 | 左外连接：R ⋈<sub>左</sub> S，结果含“所有学生（未选课者选课属性为 NULL）+ 选课记录” |


### 4. 除（Division）：复杂查询简化（难点）
- **核心作用**：解决“查询满足‘所有条件’的记录”，如“选修了所有课程的学生”“购买了某类所有商品的客户”。
- **定义**：设 R(A₁,...,Aₘ, B₁,...,Bₙ)、S(B₁,...,Bₙ)（S 属性是 R 子集），R ÷ S 结果为 R 中“B 属性组取值包含 S 全部取值”的 A 属性组元组（属性数为 m）。

- **计算步骤（简化版）**：
    1. 投影 R 中除 S 属性外的剩余属性组 A：Π<sub>A</sub>(R)；
    2. 对每个 A 的值 a，求 R 中 A=a 对应的 B 属性取值：Π<sub>B</sub>(σ<sub>A=a</sub>(R))；
    3. 筛选“该 B 取值包含 S 所有 B 取值”的 a，即为 R ÷ S 结果。

- **示例**：  
  选课表 R(Sno, Cno)、需修课程表 S(Cno) = {C1, C2}，求“选修 C1 和 C2 的学生学号”：  
  R ÷ S 结果为 Π<sub>Sno</sub>(R) 中“选课 Cno 包含 {C1,C2}”的 Sno。


## 四、关系代数的运算优先级
多运算组合时，需遵循优先级避免歧义：
1. 括号内运算优先；
2. 专门关系运算 > 传统集合运算，具体顺序：  
   **投影（Π）、选择（σ） > 连接（⋈）、除（÷） > 并（∪）、交（∩）、差（-） > 笛卡尔积（×）**；
3. 同级运算从左到右执行。


## 五、软考高频考点与例题
### 考点1：自然连接的属性数计算
**例题**：已知关系 R(A,B,C) 和 S(B,C,D)，则 R ⋈ S（自然连接）的属性个数是（ ）。  
A. 3  B. 4  C. 5  D. 6  
**解析**：自然连接基于同名属性 B、C 等值连接，且去除重复的 B、C 列，最终属性为 A（R）、B、C（公共）、D（S），共 4 个。答案：B。


### 考点2：除运算的应用场景
**例题**：设有关系 SC(Sno, Cno, Grade)（学生-课程-成绩），查询“选修了所有课程的学生学号”，关系代数表达式为（ ）。  
A. Π<sub>Sno</sub>(SC) ÷ Π<sub>Cno</sub>(SC)  B. Π<sub>Cno</sub>(SC) ÷ Π<sub>Sno</sub>(SC)  
C. σ<sub>Cno=所有</sub>(SC)  D. Π<sub>Sno</sub>(SC)  
**解析**：“选修所有课程”需满足“学生的选课 Cno 包含所有课程（Π<sub>Cno</sub>(SC)）”，符合除运算逻辑。答案：A。


### 考点3：关系代数与SQL的对应转换
**例题**：将 Π<sub>Sname</sub>(σ<sub>Age>20</sub>(Student)) 转换为 SQL 语句，正确的是（ ）。  
A. `SELECT Sname FROM Student WHERE Age>20;`  
B. `SELECT * FROM Student WHERE Age>20;`  
C. `SELECT Sname FROM Student HAVING Age>20;`  
D. `SELECT DISTINCT Sname FROM Student WHERE Age>20;`  
**解析**：投影 Π<sub>Sname</sub> 对应 `SELECT Sname`，选择 σ<sub>Age>20</sub> 对应 `WHERE Age>20`；题目未提示 Sname 重复，可省略 `DISTINCT`。答案：A。


## 六、学习建议
1. **理解优先，拒绝死记**：结合“学生-课程-选课”等实际表结构，理解运算逻辑（如自然连接=“关联+去重公共列”），而非硬记符号；
2. **关联SQL学习**：每学一个关系代数运算，对应到 SQL 语法（如选择→`WHERE`、投影→`SELECT`、自然连接→`JOIN ... USING`），强化理论与实践的联系；
3. **真题强化训练**：软考对关系代数的考核题型固定（连接、除运算、SQL 转换），通过近 5 年软件设计师/数据库工程师真题练习，可快速掌握高频考点。

掌握关系代数不仅能应对软考，更能帮助理解复杂 SQL 的执行逻辑，避免写出低效或错误的查询语句。

</span>