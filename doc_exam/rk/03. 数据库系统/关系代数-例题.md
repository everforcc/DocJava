<span  style="font-family: Simsun,serif; font-size: 17px;">

[TOC]

### 关系代数常用符号一览

- **基本集合运算**（要求 R、S 关系的属性列完全一致且同序）
  - 并集：`R ∪ S`
  - 交集：`R ∩ S`
  - 差集：`R − S`（或 `R \\ S`）
- **笛卡尔积**：`R × S`（将 R 的每个元组与 S 的每个元组合并，属性列为二者并列）
- **专门关系运算**
  - 选择：`σ_F(R)`，从 R 中选出满足谓词 F 的元组（行筛选）
  - 投影：`Π_{A1,A2,...,Ak}(R)`，从 R 中选出属性列 A1..Ak（列筛选，自动去重）
  - 重命名：`ρ_{新名(属性...)}(R)` 或 `ρ_新名(R)`
  - 连接：
    - θ 连接：`R ⋈_{θ} S`，先 `R × S` 再 `σ_θ`
    - 等值连接：`R ⋈_{A=B} S`，θ 连接中 θ 为等值条件
    - 自然连接：`R ⋈ S`，按同名属性等值连接并去除重复同名列
  - 除法：`R ÷ S`，设 `R(X,Y)`、`S(Y)`，结果为所有在 Y 上包含 S 中全部取值的 X
    - 找出R中那些X，使得每个X都"关联了"S中的所有Y。 

- 除法举例
~~~
R(学号, 课程号):
(001, C1)
(001, C2)
(002, C1)
(002, C2)
(002, C3)
(003, C1)

S(课程号):
C1
C2

R ÷ S 结果:
001  (因为001选了C1和C2，包含了S中的全部课程)
002  (因为002选了C1、C2和C3，也包含了S中的全部课程)
~~~

说明：本文例题采用典型关系模式：
- 学生：`Student(Sno, Sname, Sex, Age, Dept)`
- 课程：`Course(Cno, Cname, Dept)`
- 选课：`SC(Sno, Cno, Grade)`

为便于演算，默认：属性名同名即语义相同；自然连接遵循“同名等值、去重同名列”的定义。

---

### 例题一：并、交、差

题：已知 `R(A,B) = { (1,'a'), (2,'b'), (3,'c') }`，`S(A,B) = { (2,'b'), (3,'c'), (4,'d') }`。
求 `R ∪ S`、`R ∩ S`、`R − S`。

解：
- `R ∪ S = { (1,'a'), (2,'b'), (3,'c'), (4,'d') }`
- `R ∩ S = { (2,'b'), (3,'c') }`
- `R − S = { (1,'a') }`

---

### 例题二：笛卡尔积与选择

题：求所有分数不低于 60 分的选课记录，写出等价的“笛卡尔积+选择”表达式与标准连接表达式。

解：
- 以 `Student × SC` 再筛选：`σ_{Student.Sno = SC.Sno ∧ Grade ≥ 60}(Student × SC)`
- 等价的等值连接：`Student ⋈_{Student.Sno = SC.Sno} σ_{Grade ≥ 60}(SC)`

---

### 例题三：投影（去重）

题：求已选过课的学生学号集合。

解：`Π_{Sno}(SC)`（投影会对 `Sno` 去重）。

扩展：若要“学号与姓名”，可写 `Π_{Sno, Sname}(Student ⋈_{Student.Sno=SC.Sno} SC)`。

---

### 例题四：自然连接

题：求“学生与其所选课程名称”的所有组合，输出 `(Sno, Sname, Cname)`。

解（两种写法）：
1) 自然连接链：`Π_{Sno, Sname, Cname}(Student ⋈ SC ⋈ Course)`
   - 因 `SC` 与 `Student` 同名 `Sno`，`SC` 与 `Course` 同名 `Cno`，自然连接等价于按同名等值后去重同名列。
2) 显式等值连接：`Π_{Student.Sno, Sname, Cname}((Student ⋈_{Student.Sno=SC.Sno} SC) ⋈_{SC.Cno=Course.Cno} Course)`

---

### 例题五：θ 连接与等值连接

题：求“年龄大于 20 岁的学生及其课程”的 `(Sno, Sname, Cno)`。

解：`Π_{Sno, Sname, Cno}((σ_{Age>20}(Student)) ⋈_{Student.Sno=SC.Sno} SC)`

说明：这属于选择与等值连接的组合；若条件非等值（如 `Age − Grade > 5`）则为 θ 连接。

---

### 例题六：除法（典型考点）

题：设集合 `Sreq(Cno)` 表示“必修课程集合”。求“选修了所有必修课的学生学号集合”。

标准定义：若 `R(Sno, Cno)`、`S(Cno)`，则 `R ÷ S = { Sno | 对 S 中每个 Cno，都有 (Sno, Cno) ∈ R }`。

解：令 `R ← Π_{Sno, Cno}(SC)`，`S ← Sreq`，所求为 `Π_{Sno}(R ÷ S)`。

实现化简思路（不要求记忆推导，理解语义即可）：
```
R ÷ S = Π_{Sno}(R) − Π_{Sno}((Π_{Sno}(R) × S) − R)
```
直观解释：从“所有出现过的 Sno”中，剔除“缺少 S 中某些 Cno 的 Sno”。

---

### 例题七：连接的等价变换

题：将 `Π_{Sno, Sname}(Student ⋈ SC)` 改写为“先选再连、再投影”的形式，并与 SQL 对照。

解：
- 等价改写：`Π_{Sno, Sname}(Student ⋈_{Student.Sno=SC.Sno} Π_{Sno}(SC))`
- SQL：`SELECT DISTINCT s.Sno, s.Sname FROM Student s JOIN (SELECT DISTINCT Sno FROM SC) t ON s.Sno = t.Sno;`

---

### 例题八：组合查询

题：求“选过课程且年龄≥20”的学生姓名集合。

解：`Π_{Sname}(σ_{Age≥20}(Student) ⋈_{Student.Sno=SC.Sno} SC)`

---

### 常见等价与注意点（速记）

- `自然连接 = 等名等值连接 + 去除重复同名列`。
- `θ 连接 = 笛卡尔积 + 选择`。
- `等值连接 ⊆ θ 连接`（条件为等值谓词）。
- 投影会“去重”；SQL 中需用 `DISTINCT` 对齐。
- 集合运算（∪、∩、−）要求参与关系“并相容”（同构列）。
- 笛卡尔积的结果通常需配合选择或连接，否则语义价值低。
- 除法用于“包含全部 Y”的 X：`R(X,Y) ÷ S(Y) → X`。

---

### 自检（正确性快速核对）

- 定义核对：
  - 并、交、差：均基于集合语义；例题一结果互相一致且互不矛盾。
  - 笛卡尔积：属性列相加、元组数相乘；例题二写法满足“× 后再 σ”。
  - 投影：自动去重；例题三强调了去重并与 SQL `DISTINCT` 对齐。
  - 自然连接：同名等值且去重同名列；例题四两种写法等价。
  - θ/等值连接：`θ = × + σ`；例题五体现先筛选再连的等价性。
  - 除法：满足“对 S 中所有 y，(x,y) ∈ R”语义；例题六给出等价化简式，与标准教材一致。
- 边界核对：
  - 若 `SC` 为空，例题三投影结果为空集，符合集合语义。
  - 若 `Sreq` 为空集，则 `R ÷ Sreq = Π_{Sno}(R)`，例题六语义也成立（任何学生都“包含空集合”）。
  - 自然连接时若无同名列，退化为笛卡尔积（教材统一结论）。

以上各定义与结论与主流教材（《数据库系统概论》等）一致，推导步骤自洽，示例满足集合语义与等价变换原则。

</span>

