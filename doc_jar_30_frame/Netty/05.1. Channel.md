<span  style="font-family: Simsun,serif; font-size: 17px; ">

- 特性与重要组件

[TOC]

### 5.5 Channel

- nexus 连结
- component 组件
- capable 有能力的；有本领的，能干的；可以……的，容许……的
- A nexus to a network socket or a component which is capable of I/O operations such as read, write, connect, and bind
    - 一种连接到网络套接字或能进行读、写、连接和绑定等I/O操作的组件。
- 或者
- A channel provides a user:
    - channel为用户提供：
- the current state of the channel (e.g. is it open? is it connected?),
    - 通道当前的状态（例如它是打开？还是已连接？）
- the configuration parameters of the channel (e.g. receive buffer size),
    - channel的配置参数（例如接收缓冲区的大小）
- associated 有关联的
- the I/O operations that the channel supports (e.g. read, write, connect, and bind),
- and the ChannelPipeline which handles all I/O events and requests associated with the channel.
    - channel支持的IO操作（例如读、写、连接和绑定），以及处理与channel相关联的所有IO事件和请求的ChannelPipeline。

### 5.5.1 获取channel的状态

~~~
boolean isOpen(); //如果通道打开，则返回true
boolean isRegistered();//如果通道注册到EventLoop，则返回true
boolean isActive();//如果通道处于活动状态并且已连接，则返回true
boolean isWritable();//当且仅当I/O线程将立即执行请求的写入操作时，返回true。
~~~

### 5.5.2 获取channel的配置参数

- 获取单条配置信息，使用getOption()，代码演示：

~~~
ChannelConfig config = channel.config();//获取配置参数
//获取ChannelOption.SO_BACKLOG参数,
Integer soBackLogConfig = config.getOption(ChannelOption.SO_BACKLOG);
//因为我启动器配置的是128，所以我这里获取的soBackLogConfig=128
~~~

- 获取多条配置信息，使用getOptions()，代码演示：

~~~
ChannelConfig config = channel.config();
Map<ChannelOption<?>, Object> options = config.getOptions();
for (Map.Entry<ChannelOption<?>, Object> entry : options.entrySet()) {
 System.out.println(entry.getKey() + " : " + entry.getValue());
}
/**
SO_REUSEADDR : false
WRITE_BUFFER_LOW_WATER_MARK : 32768
WRITE_BUFFER_WATER_MARK : WriteBufferWaterMark(low: 32768, high: 65536)
SO_BACKLOG : 128
以下省略...
*/
~~~

### 5.5.3 channel支持的IO操作

- 写操作，这里演示从服务端写消息发送到客户端：

~~~
@Override
public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {
ctx.channel().writeAndFlush(Unpooled.copiedBuffer("这波啊，这波是肉蛋葱鸡~", CharsetUtil.UTF_8));
}
~~~

- 客户端控制台：

~~~
//收到服务端/127.0.0.1:6666的消息：这波啊，这波是肉蛋葱鸡~
~~~

- 连接操作，代码演示：

~~~
ChannelFuture connect = channelFuture.channel().connect(new InetSocketAddress("127.0.0.1", 6666));//一般使用启动器，这种方式不常用
~~~

- 通过channel获取ChannelPipeline，并做相关的处理：

~~~
//获取ChannelPipeline对象
ChannelPipeline pipeline = ctx.channel().pipeline();
//往pipeline中添加ChannelHandler处理器，装配流水线
pipeline.addLast(new MyServerHandler());
~~~

</span>