<span style="font-family:Simsun,serif; font-size:17px;">

[TOC]

### 参考

- [多路IO复用模型：非阻塞IO](https://zhuanlan.zhihu.com/p/615586279)

### I/O 多路复用

- 可以通过一次系统调用，检查多个文件描述符的状态。
- 这是 I/O 多路复用的主要优点，相比于非阻塞 I/O，在文件描述符较多的场景下，避免了频繁的用户态和内核态的切换，减少了系统调用的开销。
- I/O 多路复用相当于将「遍历所有文件描述符、通过非阻塞 I/O 查看其是否就绪」的过程从用户线程移到了内核中，由内核来负责轮询。

#### 内部如何操作

- 进程可以通过 select、poll、epoll 发起 I/O
- 多路复用的系统调用，这些系统调用都是同步阻塞的：
    - 如果传入的多个文件描述符中，有描述符就绪，则返回就绪的描述符；
    - 否则如果所有文件描述符都未就绪，就阻塞调用进程，直到某个描述符就绪，或者阻塞时长超过设置的 timeout 后，再返回。
    - I/O多路复用内部使用非阻塞 I/O 检查每个描述符的就绪状态。
- 如果 timeout参数设为 NULL，会无限阻塞直到某个描述符就绪；
    - 如果timeout参数设为 0，会立即返回，不阻塞。
- I/O 多路复用引入了一些额外的操作和开销，性能更差。但是好处是用户可以在一个线程内同时处理多个 I/O 请求。
- 如果不采用 I/O 多路复用，则必须通过多线程的方式，每个线程处理一个 I/O 请求。后者线程切换也是有一定的开销的。

</span>