<span  style="font-family: Simsun,serif; font-size: 17px; ">

### 问题背景

- 有一个服务在本地系统部署，没有公网，这样的系统有好几个，每一个系统有独立的账号
- 有一个云服务，有公网，每个本地系统的账号在云端都有保存
- 现在有一个需求，需要用本地账号的用户名，不用密码在云服务登录获取token，但是又担心不安全，有什么方案
- 语言 java，mysql，redis

### 简单描述

1. 有一组布防组
2. 布防组内有一组设备，分为设备类型，设备型号
3. 每个设备可以上报事件，如果布防就上报，否则不上报
4. 布防组按时间段区分，周循环，一天24小时，每半个小时一个间隔，从1开始计数，最大48，每个间隔可以选择布防或者撤防
5. 每个布防组可以对应多个设备，每个设备只能在一个布防组
6. 设备如果布防，设备数量多的情况下，每次都要校验是否需要上报
7. 撤防逻辑，以天为单元,最早当天0点，最晚当天24点，如果当前在布防时间段撤防当前，如果当前在撤防时间段撤防下一个布防时间段
   7.1. 如果当前时间是布防时间段，点击撤防，撤防当前时间段，最早开始时间0点，最晚结束时间24点
   7.2. 如果当前时间是撤防时间段，点击撤防，撤防当天的下一个布防时间段，最晚截止24点
   7.3. 举例 周一到周日每天，0点到8点布防，8点到12点撤防，12点到14点布防，14点到18点撤防，18点到24点布防，
   7.4. 举例1， 0点到8点点击撤防，0点到8点撤防，剩下时间依旧
   7.5. 举例2， 8点到12点点击撤防，12点到14点撤防，剩下时间依旧
   7.6. 举例3， 12点到14点点击撤防，12点到14点撤防，剩下时间依旧
   7.7. 举例4， 14点到18点点击撤防，14点到18点撤防，剩下时间依旧
   7.8. 举例5， 18点到24点点击撤防，18点到24点撤防，剩下时间依旧
   7.10. 不能连续撤防两个布防的时间段
[测试场景.md](%E6%B5%8B%E8%AF%95%E5%9C%BA%E6%99%AF.md)
- 在这个背景下，给个设计方案方案，优化执行速度

#### 撤防详细逻辑

- 不能连续撤防两个布防的时间段，
- 举例 周一到周日每天，0点到8点布防，8点到12点撤防，12点到14点布防，14点到18点撤防，18点到24点布防，
- 举例 0点到8点点击撤防，0点到8点撤防，剩下时间依旧，在这个时间段内，继续点击撤防无效.
- 直到，8点到12点和12点到14点点击撤防,12点到14点撤防。
- 然后，14点到18点和18点到24点点击撤防，18点到24点撤防。
- 当日结束

#### 布防详细逻辑

- 如果当日没有任何撤防操作，那么布防操作不进行任何修改
- 如果有撤防操作，分为如下场景
- 举例 周一到周日每天，0点到8点布防，8点到12点撤防，12点到14点布防，14点到18点撤防，18点到24点布防，

1. 0点到8点，点击撤防，然后又点击布防，那么这个时间段重新布防
2. 0点到8点，点击撤防，8点以后点击布防，则没有任何改变
3. 8点到12点和12点到14点，点击撤防，12点到14点撤防，在这两个时间段内，点击布防，则12点到14点重新布防

### 问题1

代码没看懂，再给我解释下这个场景
举例 周一到周日每天，0点到8点布防，8点到12点撤防，12点到14点布防，14点到18点撤防，18点到24点布防，

1. 当天没有点击按钮，分别在每个区间上报事件是什么结果
2. 当天分别在每个区间点击按钮的场景，每个区间上报事件是什么结果

### 问题2

1. 每次arming_group_today_mask都是相对arming_group_schedule的增量吗？
2. 第一次布防成功，加一次增量，第二次布防成功，在第一次的基础上在进行一次增量，的到最终数据吗？
3. 直接查询redis，如果没有数据怎么办，有的代码没有从mysql重新获取数据
4. 系统启动的时候，预热数据，将数据加载到redis

</span>