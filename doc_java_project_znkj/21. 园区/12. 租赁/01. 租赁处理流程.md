<span  style="font-family: Simsun,serif; font-size: 17px; ">

### 事件数据同步

- [x] 1.本地园区同步数据
- [x] 2.云端新增一张相同结构的表插入数据来做处理

### 事件和值守人员的关系

- 值守人员
    - 经销商下面的 sn存起来
    - sn去事件表里面查
- 值守人员
- 事件
    - 都用组去关联

### 打卡上班

- 上班后，用户数据存入redis
- 打卡下班，用户数据从redis移除
- 经销商id,值守人员list

### 事件处理

- [ ] 1.事件值守人员，查到他能处理的数据，经销商名下的
- [ ] 事件也要分组
- [ ] 2.事件处理分两类，派单和抢单

#### 派单

- 人员也需要分组
- 按照登陆时间插入list
    - list中去取下一次该分配的人员
- redis存个流水号
    - 每个经销商一个，前缀加上经销商id
    - 每次取出来然后加一存进去
    - 如果大于list最大长度，修改为0
- 如果有值守人员，定时任务查出事件
    - 按顺序分配给值守人员
    - [x] 如果只有一个人上线，那么一瞬间就会分发所有的事件？
    - 设置上限

#### 抢单

- 点击上班的时候分类加入集合
- 全部放到本地map里面
    - ~~<经销商id,<值守人员id,session>>~~
    - <组id,<值守人员id,session>>
- 如果经销商有在线的值守人员
    - 按照频率用经销商id对应的sn查询事件，然后推送给在线的人员
- 在线人员，点击抢单
    - 后台根据sn校验是否合法
    - 加锁抢单
    - 返回成功或失败

</span>