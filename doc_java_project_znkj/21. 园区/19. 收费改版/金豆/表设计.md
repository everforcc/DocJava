<span  style="font-family: Simsun,serif; font-size: 17px; ">

### 金豆逻辑

1. 创建订单的时候校验数量
2. 订单处理分账逻辑
3. 回调的时候扣减

### 金豆详情表

- zn_coin

| 字段 | 说明 |
| --- | --- |
| 公共字段 | |
| userId | 经销商id |
| balance | 金豆数余额 |
| alarm_balance | 金豆报警下限 |

- 每天九点报警一次
~~~
SELECT 
    userId AS `经销商ID`,
    balance AS `金豆余额`,
    alarm_balance AS `报警下限`
FROM zn_coin
WHERE balance < alarm_balance;

~~~

### 金豆明细表

- zn_coin_detail

| 字段 | 说明 |
| --- | --- |
| 公共字段 | |
| type | 类型 1 充值 2 支出 |
| orderId | 订单id |
| userId | 用户id |
| balance_start | 当次消费前余额 |
| num | 金豆数 |
| balance_end | 当次消费后余额 |
| --- | --- |
| --- | --- |
| --- | --- |
| --- | --- |

### 流程

~~~
1. 插入金豆明细表
2. 
~~~

</span>