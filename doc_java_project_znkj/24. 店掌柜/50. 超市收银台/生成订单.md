<span  style="font-family: Simsun,serif; font-size: 17px; ">

### 生成订单流程

- 会员

~~~mermaid
graph LR
    会员 --> 使用该卡
    使用该卡 --> 余额足够 --> 成功生成订单
    使用该卡 --> 余额不足
    余额不足 --> 生成待支付订单
    生成待支付订单 --> 付款
    付款 --> 现金
    付款 --> 扫码付款
    现金 --> 付款成功
    扫码付款 --> 付款成功 --> 成功生成订单
    扫码付款 --> 付款失败 --> 生成待支付订单
    生成待支付订单 --> 取消
    取消 --> 主动取消
    取消 --> 定时取消
~~~

- 非会员

~~~mermaid
graph LR
    非会员 --> 现金 --> 成功生成订单
    非会员 --> 扫码 --> 生成待支付订单
    生成待支付订单 --> 付款
    付款 --> 现金
    付款 --> 扫码
    扫码 --> 付款成功 --> 成功生成订单
    扫码 --> 付款失败 --> 生成待支付订单
    生成待支付订单 --> 取消
    取消 --> 主动取消
    取消 --> 定时取消
~~~

#### 接口清单

1. 生成已支付订单
2. 生成待支付订单
3. 现金支付
4. 扫码支付
5. 重新发起支付
6. 手动取消订单
7. 定时取消订单
8. 退款-整单
9. 退款-单商品

#### 非会员

- [ ] 1.现金 useCash
- [ ] 2.扫码 scanAilCode
    - [ ] 生成订单-待支付
    - [ ] 扫码付款
    - [ ] 支付付款
- [ ] 3.重新支付
- [ ] 4.退款

#### 会员

- [ ] 1.使用卡券 useCard
    - [ ] 验证密码
- [ ] 计算金额 billCal
    - [ ] 1.1.余额足够
        - [ ] 直接生成已支付订单
    - [ ] 1.2.余额不足
        - [ ] 卡券的钱先扣掉
        - [ ] 生成待支付订单
        - [ ] 返回待支付金额
            - [ ] 现金 useCash
            - [ ] 扫码 scanAilCode
        - [ ] 支付成功，生成已支付订单
        - [ ] 支付失败，生成待支付订单
- [ ] 2.生成订单 generateOrder
- [ ] 3.待支付，取消订单 cancelOrder
    - [ ] 主动取消，定时取消
        - [ ] 如果是会员扣卡券，需要再加回去
    - [ ] 支付成功
- [ ] 4.待支付，重新支付 afreshIrder
    - [ ] 只负责收钱，不允许修改其他属性
    - [ ] 4.1.现金 useCash
    - [ ] 4.2.扫码 scanAilCode
- [ ] 5.扫码支付，反扫
- [ ] 6.退款
    - [ ] 6.1.整单退
    - [ ] 6.2.单个退

### 代码流程

1. 生成订单
2. 待支付
3. 扫码付款 scan
    1. 读取用户的条码--》支付码
    2. 安全信息--》服务器ip
    3. 请求日期
    4. 流水号
    5. 账户号
    6. 交易金额
    7. 商品描述
    8. 回调地址
    9. 交易备注
4. 非会员
    1. 直接成功
5. 会员
    1. 充值卡券
    2. 订单结算

</span>