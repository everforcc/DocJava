<span  style="font-family: Simsun,serif; font-size: 17px; ">

### 普通商品回调 type 1,3

- 需要判断有没有卡

1. 余额和次卡,足够支付订单
    - 1.1 抵扣余额，次数，库存 jsy 方法二
    - 1.2 直接使用，订单完成
2. 用卡的情况下，卡余额不足，或者次数不足
    - 1.1 冲卡，余额 ,扫码
    - 1.1.1 中间表，未成功到卡余额，次数
    - 1.2 汇付 回掉
    - 1.3 订单id ，
    - 1.3.1 卡余额，到账,次数，到账 jsy 方法三
    - 1.3.2 查订单，查出余额，次数，库存数量 jsy 方法一，前几行
    - 1.3.3 抵扣 余额,次卡，库存 jsy 方法一，后几行
    - boolean
    - 1.3.4 更新订单状态未成功

- 不需要判断卡是否有余额属性，一旦扫码，钱就进入余额
- 订单主表 end_price, card_id
- 子表    (goods_id,card_num 扣次数)  (goods_id,goods_num 扣库存)
- 举例 次卡 只有3次可乐
    - 1瓶 ，card_num 1次
    - 3瓶 ，3 次
    - 5瓶 ，3 次

### 卡券回调 type 2

- 购买，续费
- 购买
    - 购买
        - 状态为 0
    - 回调
        - 更新状态0->1
- 续费
    - 续费
        - log，status，~~0 待支付 中间表~~
        - 生成订单（goods_id,type 卡券）
    - 回调
        - log，status，~~1 已支付 中间表~~
        - 从中间表将属性，设置到卡属性
        - 更新订单状态，

### 会员

- [ ] zn_dzg_product.spec_name 单规格多规格，都需要在这里设置规格

</span>