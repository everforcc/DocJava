<span style="font-family:Simsun,serif; font-size:17px;">

[TOC]

### 1. 什么项目

- 新优码
- 旧的优码系统存在大量冗余业务，技术比较旧，响应慢
- 根据旧系统订单系统每天最多有50w数据
- 主要模块儿

#### 项目简介

- 优码项目为各类商场，购物中心，单位等打造支付解决方案。一店一码，商户经营更加方便。
- 支持普通商户开户，配置商户信息，支付信息
- 配置自己的商品信息，支持查看已缴费，未缴费信息。也可以通过公众号手脚信息
- 也支持商家APP语音收款提示。同时也可以配置悦打印，E开票，给对应的订单开票
- 同时后台支持商户对账管理，提高商场财务管理能力

### 2. 角色和职责

- 开发

### 3. 技术栈

- 系统采用前后端分离模式，配置中心Apollo,注册中心zookeeper,通过https协议与nginx转发，进入统一的网关，根据不同业务分为不同的服务，网关和服务间通过dubbo调用,redis集群做缓存中间件，对配置项，用户等信息缓存，降低mysql压力。系统与外部系统接口使用httpclient交互，因为数据和情况复杂以及安全需要自定义各种参数。
- 前端接口通过nginx转发接入idc网关
- dubbo
- apollo + zookeeper
- mysql 主从
- redis 集群
- es数据中心，通过http连接
- 权限这块儿是自己写的
    - 自定义的注解
    - 通过登录用户来查询当前的角色控制，控制粒度没有那么细
- 加密
    - sm4和aes
- JSR303数据校验
- 日志链路追踪
- 优化了订单导出
    - 分批查询插入

### 4. 主要功能和特点

- 表单，因为需要面向各种各样的客户，他们需要的表单格式也不相同，所以定义了一组组件
    - 比如常见的，文本输入框，金额输入框，时间，密码
    - 还有各种显隐配置等等
    - 每一次表单的创建都带有版本号，方便扩展和回溯
- 表单配置
    - 用户根据已有的控件配置自己的表单
- 商户信息配置
    - 比如商户的支付信息
- 表单创建
- 支付宝支付这一块儿的
- 表单信息导出
    - 数据量大，使用的是google的excel4j，对源码进行了调整
    - 可以分批插入
    - 每次读完数据，通过修改偏移量来达到目的
    - 还有就是加锁，业务+用户，单位时间内只能有一个
    - 后台生成后，前端给个查询列表，然后去导出

#### 商户档案管理平台

- 商户项目管理
- 应用管理
- 合同管理

#### 商户工作台

- 登录
- 修改密码
- 部门层级管理
- 角色
    - 自定义
- 应用启用，停用
- 订单查询

#### 云表单配置平台

- 支付信息配置
- 字段配置
- 表单配置
- 二维码管理
    - 使用google的zxing处理

### 5. 团队合作

- 产品经理
- 前端、UI
- 开发
- 测试

### 6. 遇到的困难和解决方案

- 接口校验
- 链路追踪
- 表单自定义配置，版本管理等
- 订单数据量大，分表，重写excel4j的导出逻辑，可以自定义起始位置

### 7. 个人收获

</span>